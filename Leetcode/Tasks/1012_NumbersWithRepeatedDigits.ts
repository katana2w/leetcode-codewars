/**
 * https://leetcode.com/problems/numbers-with-repeated-digits/description/
 *
 * Given an integer n, return the number of positive integers in the range [1, n] that have at least one repeated digit.
 *
 *
 *
 * Example 1:
 *
 * Input: n = 20
 * Output: 1
 * Explanation: The only positive number (<= 20) with at least 1 repeated digit is 11.
 * Example 2:
 *
 * Input: n = 100
 * Output: 10
 * Explanation: The positive numbers (<= 100) with atleast 1 repeated digit are 11, 22, 33, 44, 55, 66, 77, 88, 99, and 100.
 * Example 3:
 *
 * Input: n = 1000
 * Output: 262
 *
 *
 * Constraints:
 *
 * 1 <= n <= 109
 *
 * ----------------------------------------------------------
 *
 * Ð Ð°Ñ…ÑƒÐ²Ð°Ñ‚Ð¸ Ð½Ð°Ð¿Ñ€ÑÐ¼Ñƒ â€œÑÐºÑ–Ð»ÑŒÐºÐ¸ Ð¼Ð°ÑŽÑ‚ÑŒ Ð¿Ð¾Ð²Ñ‚Ð¾Ñ€Ð¸â€ Ð½ÐµÐ·Ñ€ÑƒÑ‡Ð½Ð¾. Ð—Ð°Ñ‚Ðµ Ð»ÐµÐ³ÐºÐ¾ Ð¿Ð¾Ñ€Ð°Ñ…ÑƒÐ²Ð°Ñ‚Ð¸ Ð¿Ñ€Ð¾Ñ‚Ð¸Ð»ÐµÐ¶Ð½Ðµ:
 *
 * Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´ÑŒ = n âˆ’ (ÐºÑ–Ð»ÑŒÐºÑ–ÑÑ‚ÑŒ Ñ‡Ð¸ÑÐµÐ» Ñƒ [1..n], Ð´Ðµ Ð²ÑÑ– Ñ†Ð¸Ñ„Ñ€Ð¸ Ñ€Ñ–Ð·Ð½Ñ–).
 *
 * Ð¯Ðº Ð¿Ð¾Ñ€Ð°Ñ…ÑƒÐ²Ð°Ñ‚Ð¸ â€œÐ²ÑÑ– Ñ†Ð¸Ñ„Ñ€Ð¸ Ñ€Ñ–Ð·Ð½Ñ–â€ (â‰¤ n)
 *
 * ÐÐµÑ…Ð°Ð¹ n Ð¼Ð°Ñ” k Ñ†Ð¸Ñ„Ñ€.
 *
 * 1) Ð£ÑÑ– Ñ‡Ð¸ÑÐ»Ð° Ð· Ð¼ÐµÐ½ÑˆÐ¾ÑŽ ÐºÑ–Ð»ÑŒÐºÑ–ÑÑ‚ÑŽ Ñ†Ð¸Ñ„Ñ€
 *
 * Ð”Ð»Ñ Ð´Ð¾Ð²Ð¶Ð¸Ð½Ð¸ len:
 *
 * Ð¿ÐµÑ€ÑˆÐ° Ñ†Ð¸Ñ„Ñ€Ð°: 1..9 â†’ 9 Ð²Ð°Ñ€Ñ–Ð°Ð½Ñ‚Ñ–Ð²
 *
 * Ñ€ÐµÑˆÑ‚Ð° len-1 Ñ†Ð¸Ñ„Ñ€: Ð²Ð¸Ð±Ð¸Ñ€Ð°Ñ”Ð¼Ð¾ Ð±ÐµÐ· Ð¿Ð¾Ð²Ñ‚Ð¾Ñ€Ñ–Ð² Ñ–Ð· 9,8,7,...
 *
 * Ð¢Ð¾Ð±Ñ‚Ð¾:
 *
 * ð‘
 * ð‘œ
 * ð‘¢
 * ð‘›
 * ð‘¡
 * (
 * ð‘™
 * ð‘’
 * ð‘›
 * )
 * =
 * 9
 * â‹…
 * ð‘ƒ
 * (
 * 9
 * ,
 * ð‘™
 * ð‘’
 * ð‘›
 * âˆ’
 * 1
 * )
 * count(len)=9â‹…P(9,lenâˆ’1)
 *
 * Ð´Ðµ P(m, t) â€” ÐºÑ–Ð»ÑŒÐºÑ–ÑÑ‚ÑŒ Ð¿ÐµÑ€ÐµÑÑ‚Ð°Ð½Ð¾Ð²Ð¾Ðº: m*(m-1)*...*(m-t+1).
 *
 * 2) Ð§Ð¸ÑÐ»Ð° Ð· Ñ‚Ñ–Ñ”ÑŽ Ð¶ Ð´Ð¾Ð²Ð¶Ð¸Ð½Ð¾ÑŽ k, Ð°Ð»Ðµ â‰¤ n
 *
 * Ð™Ð´ÐµÐ¼Ð¾ Ð·Ð»Ñ–Ð²Ð° Ð½Ð°Ð¿Ñ€Ð°Ð²Ð¾ Ð¿Ð¾ Ñ†Ð¸Ñ„Ñ€Ð°Ñ… n Ñ– Ð½Ð° Ð¿Ð¾Ð·Ð¸Ñ†Ñ–Ñ— i Ð¿Ñ€Ð¾Ð±ÑƒÑ”Ð¼Ð¾ Ð¿Ð¾ÑÑ‚Ð°Ð²Ð¸Ñ‚Ð¸ Ð¼ÐµÐ½ÑˆÑƒ Ñ†Ð¸Ñ„Ñ€Ñƒ d, ÑÐºÐ° Ñ‰Ðµ Ð½Ðµ Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð½Ð°, Ñ– Ð´Ð¾Ð´Ð°Ñ”Ð¼Ð¾ ÐºÑ–Ð»ÑŒÐºÑ–ÑÑ‚ÑŒ ÑÐ¿Ð¾ÑÐ¾Ð±Ñ–Ð² Ð·Ð°Ð¿Ð¾Ð²Ð½Ð¸Ñ‚Ð¸ Ñ…Ð²Ñ–ÑÑ‚ Ð±ÐµÐ· Ð¿Ð¾Ð²Ñ‚Ð¾Ñ€Ñ–Ð².
 *
 * ÑÐºÑ‰Ð¾ Ð¼Ð¸ Ð½Ð° Ð¿Ð¾Ð·Ð¸Ñ†Ñ–Ñ— i, Ñ‚Ð¾ Ð·Ð°Ð»Ð¸ÑˆÐ¸Ð»Ð¾ÑÑŒ k - i - 1 Ñ†Ð¸Ñ„Ñ€
 *
 * Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¸Ñ… Ñ†Ð¸Ñ„Ñ€ Ð»Ð¸ÑˆÐ°Ñ”Ñ‚ÑŒÑÑ 10 - (i+1) (Ð±Ð¾ Ð²Ð¶Ðµ Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð½Ð¾ i+1 Ñ€Ñ–Ð·Ð½Ð¸Ñ…)
 *
 * Ð”Ð¾Ð´Ð°Ñ”Ð¼Ð¾:
 *
 * ð‘ƒ
 * (
 * 10
 * âˆ’
 * (
 * ð‘–
 * +
 * 1
 * )
 * ,
 *
 * ð‘˜
 * âˆ’
 * ð‘–
 * âˆ’
 * 1
 * )
 * P(10âˆ’(i+1), kâˆ’iâˆ’1)
 *
 * Ð¯ÐºÑ‰Ð¾ Ð½Ð° ÑÐºÐ¾Ð¼ÑƒÑÑŒ ÐºÑ€Ð¾Ñ†Ñ– Ñ†Ð¸Ñ„Ñ€Ð° n[i] Ð²Ð¶Ðµ Ð±ÑƒÐ»Ð° Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð½Ð° â€” Ð´Ð°Ð»Ñ– Ð²Ð¶Ðµ Ð½Ðµ Ð¼Ð¾Ð¶Ð½Ð° Ð·Ñ€Ð¾Ð±Ð¸Ñ‚Ð¸ Ñ‡Ð¸ÑÐ»Ð¾ Ð· Ñ€Ñ–Ð·Ð½Ð¸Ð¼Ð¸ Ñ†Ð¸Ñ„Ñ€Ð°Ð¼Ð¸, Ð·ÑƒÐ¿Ð¸Ð½ÑÑ”Ð¼Ð¾ÑÑŒ.
 *
 * Ð¯ÐºÑ‰Ð¾ Ð¿Ñ€Ð¾Ð¹ÑˆÐ»Ð¸ Ð²ÑÑ– Ð¿Ð¾Ð·Ð¸Ñ†Ñ–Ñ— Ð±ÐµÐ· Ð¿Ð¾Ð²Ñ‚Ð¾Ñ€Ñ–Ð² â€” Ð´Ð¾Ð´Ð°Ñ”Ð¼Ð¾ 1 (ÑÐ°Ð¼Ðµ Ñ‡Ð¸ÑÐ»Ð¾ n Ñ‚ÐµÐ¶ â€œÑƒÐ½Ñ–ÐºÐ°Ð»ÑŒÐ½Ðµâ€).
 *
 */

function numDupDigitsAtMostN(n: number): number {
    // P(m, t) = m * (m-1) * ... * (m-t+1)
    function perm(m: number, t: number): number {
        let res = 1;
        for (let i = 0; i < t; i++) res *= (m - i);
        return res;
    }

    function countUniqueAtMost(n: number): number {
        const digits = String(n).split("").map(Number);
        const k = digits.length;

        let total = 0;

        // 1) Ð²ÑÑ– ÑƒÐ½Ñ–ÐºÐ°Ð»ÑŒÐ½Ñ– Ñ‡Ð¸ÑÐ»Ð° Ð· Ð¼ÐµÐ½ÑˆÐ¾ÑŽ ÐºÑ–Ð»ÑŒÐºÑ–ÑÑ‚ÑŽ Ñ†Ð¸Ñ„Ñ€
        for (let len = 1; len < k; len++) {
            total += 9 * perm(9, len - 1);
        }

        // 2) ÑƒÐ½Ñ–ÐºÐ°Ð»ÑŒÐ½Ñ– Ñ‡Ð¸ÑÐ»Ð° Ð· Ð´Ð¾Ð²Ð¶Ð¸Ð½Ð¾ÑŽ k, Ñ‰Ð¾ <= n
        const used = new Set<number>();

        for (let i = 0; i < k; i++) {
            const cur = digits[i];

            // Ð¿ÐµÑ€ÐµÐ±Ð¸Ñ€Ð°Ñ”Ð¼Ð¾ Ð¼ÐµÐ½ÑˆÑ– Ñ†Ð¸Ñ„Ñ€Ð¸ Ð½Ð° Ñ†Ñ–Ð¹ Ð¿Ð¾Ð·Ð¸Ñ†Ñ–Ñ—
            for (let d = (i === 0 ? 1 : 0); d < cur; d++) {
                if (used.has(d)) continue;
                // Ð¿Ñ–ÑÐ»Ñ Ð²Ð¸Ð±Ð¾Ñ€Ñƒ d, Ð»Ð¸ÑˆÐ¸Ñ‚ÑŒÑÑ Ð·Ð°Ð¿Ð¾Ð²Ð½Ð¸Ñ‚Ð¸ (k - i - 1) Ð¿Ð¾Ð·Ð¸Ñ†Ñ–Ð¹
                // Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¸Ñ… Ñ†Ð¸Ñ„Ñ€: 10 - (i+1)
                total += perm(10 - (i + 1), k - i - 1);
            }

            // ÑÐºÑ‰Ð¾ Ð¿Ð¾Ñ‚Ð¾Ñ‡Ð½Ð° Ñ†Ð¸Ñ„Ñ€Ð° Ð²Ð¶Ðµ Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð½Ð° â€” Ð´Ð°Ð»Ñ– Ð½Ðµ Ð±ÑƒÐ´Ðµ ÑƒÐ½Ñ–ÐºÐ°Ð»ÑŒÐ½Ð¸Ñ…
            if (used.has(cur)) return total;
            used.add(cur);
        }

        // ÑÐ°Ð¼Ðµ n Ñ‚ÐµÐ¶ Ð¼Ð°Ñ” Ð²ÑÑ– Ñ€Ñ–Ð·Ð½Ñ– Ñ†Ð¸Ñ„Ñ€Ð¸
        return total + 1;
    }

    const unique = countUniqueAtMost(n);
    return n - unique; // Ð¼Ð°ÑŽÑ‚ÑŒ Ñ…Ð¾Ñ‡Ð° Ð± Ð¾Ð´Ð¸Ð½ Ð¿Ð¾Ð²Ñ‚Ð¾Ñ€
}
